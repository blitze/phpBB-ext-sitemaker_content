{"version":3,"sources":["fields/textarea.min.js"],"names":["$","window","document","ready","phpbb","bbcodeEditors","focus","this","attr","plupload","updateBbcode","action","index","each","textarea","form","text","val","removal","indexOf","i","ids","length","runUpdate","regex","RegExp","replace","_","fileName","el","orientation","data","height","width","bbcode","html","colorPalette","on","e","color","bbfontstyle","preventDefault","tocItems","click","url","match","page","hide","show","removeClass","filter","addClass","jQuery"],"mappings":"CAAA,SAAUA,EAAGC,EAAQC,GACpB,aAEAF,EAAEE,GAAUC,MAAM,WACjB,IAAIC,EAAQH,EAAOG,OAAS,GACxBC,EAAgBL,EAAE,gCAAgCM,MAAM,WAC3DL,EAAkB,UAAID,EAAEO,MAAMC,KAAK,UAYpCJ,EAAMK,SAASC,aAAe,SAASC,EAAQC,GAC9CP,EAAcQ,KAAK,WAClB,IAAIC,EAAWd,EAAEO,KAAMH,EAAMK,SAASM,MAClCC,EAAOF,EAASG,MAChBC,EAAsB,YAAXP,EAGf,IAAsC,IAAlCK,EAAKG,QAAQ,gBAAjB,CAkBA,IAAIC,EACJ,GAAIF,EACH,IAAKE,EAAIR,EAAOQ,EAAIhB,EAAMK,SAASY,IAAIC,OAAQF,IAC9CG,EAAUH,QAGX,IAAKA,EAAIhB,EAAMK,SAASY,IAAIC,OAAS,EAAQV,GAALQ,EAAYA,IACnDG,EAAUH,GAIZN,EAASG,IAAID,GAzBb,SAASO,EAAUH,GAClB,IAAII,EAAQ,IAAIC,OAAO,iBAAmBL,EAAI,8BAA+B,KAC7EJ,EAAOA,EAAKU,QAAQF,EAAO,SAAsBG,EAAGC,GAEnD,OAAIV,GAAWN,IAAUQ,EACjB,GAGD,gBADQA,GAAK,GAAa,EAAI,IACF,IAAMQ,EAAW,sBAqBxD5B,EAAE,kBAAkBa,KAAK,WACxB,IAAIgB,EAAK7B,EAAEO,MACPuB,EAAcD,EAAGE,KAAK,eACtBC,EAAUH,EAAGE,KAAK,UAClBE,EAASJ,EAAGE,KAAK,SACjBG,EAAUL,EAAGrB,KAAK,eAGtBqB,EAAGM,KAAK/B,EAAMgC,aAAaN,EAAaG,EAAOD,IAG/ChC,EAAE6B,GAAIQ,GAAG,QAAS,IAAK,SAASC,GAC/B,IAAIC,EAAQvC,EAAEO,MAAMC,KAAK,cAErB0B,GACHjC,EAAOuC,YAAY,WAAaD,EAAQ,IAAK,YAE9CD,EAAEG,qBAIJ,IAAIC,EAAW1C,EAAE,qEAAqE2C,MAAM,SAASL,GACpG,IAAIM,EAAM5C,EAAEO,MAAMC,KAAK,QAAQqC,MAAM,YACjCC,EAAgB,OAARF,EAAgBA,EAAI,GAAK,EACrC5C,EAAE,UAAU+C,OACZ/C,EAAE,SAAW8C,GAAME,OACnBN,EAASO,YAAY,WACV,EAAPH,EACHJ,EAASQ,OAAO,WAAaJ,EAAO,MAAMK,SAAS,WAEnDT,EAASQ,OAAO,UAAUC,SAAS,WAEpCb,EAAEG,qBA1FL,CA6FGW,OAAQnD,OAAQC","file":"textarea.min.js","sourcesContent":["(function($, window, document) {\n\t'use strict';\n\n\t$(document).ready(function() {\n\t\tvar phpbb = window.phpbb || {};\n\t\tvar bbcodeEditors = $('textarea[data-bbcode=\"true\"]').focus(function() {\n\t\t\twindow['text_name'] = $(this).attr('name');\n\t\t});\n\n\t\t/**\n\t\t * Update the indices used in inline attachment bbcodes. This ensures that the\n\t\t * bbcodes correspond to the correct file after a file is added or removed.\n\t\t * This should be called before the phpbb.plupload,data and phpbb.plupload.ids\n\t\t * arrays are updated, otherwise it will not work correctly.\n\t\t *\n\t\t * @param {string} action\tThe action that occurred -- either \"addition\" or \"removal\"\n\t\t * @param {int} index\t\tThe index of the attachment from phpbb.plupload.ids that was affected.\n\t\t */\n\t\tphpbb.plupload.updateBbcode = function(action, index) {\n\t\t\tbbcodeEditors.each(function() {\n\t\t\t\tvar\ttextarea = $(this, phpbb.plupload.form);\n\t\t\t\tvar text = textarea.val();\n\t\t\t\tvar removal = (action === 'removal');\n\n\t\t\t\t// Return if the bbcode isn't used at all.\n\t\t\t\tif (text.indexOf('[attachment=') === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction runUpdate(i) {\n\t\t\t\t\tvar regex = new RegExp('\\\\[attachment=' + i + '\\\\](.*?)\\\\[\\\\/attachment\\\\]', 'g');\n\t\t\t\t\ttext = text.replace(regex, function updateBbcode(_, fileName) {\n\t\t\t\t\t\t// Remove the bbcode if the file was removed.\n\t\t\t\t\t\tif (removal && index === i) {\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar newIndex = i + ((removal) ? -1 : 1);\n\t\t\t\t\t\treturn '[attachment=' + newIndex + ']' + fileName + '[/attachment]';\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Loop forwards when removing and backwards when adding ensures we don't\n\t\t\t\t// corrupt the bbcode index.\n\t\t\t\tvar i;\n\t\t\t\tif (removal) {\n\t\t\t\t\tfor (i = index; i < phpbb.plupload.ids.length; i++) {\n\t\t\t\t\t\trunUpdate(i);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = phpbb.plupload.ids.length - 1; i >= index; i--) {\n\t\t\t\t\t\trunUpdate(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttextarea.val(text);\n\t\t\t});\n\t\t};\n\n\t\t$('.color_palette').each(function() {\n\t\t\tvar el = $(this);\n\t\t\tvar\torientation\t= el.data('orientation');\n\t\t\tvar height\t\t= el.data('height');\n\t\t\tvar width\t\t= el.data('width');\n\t\t\tvar bbcode\t\t= el.attr('data-bbcode');\n\n\t\t\t// Insert the palette HTML into the container.\n\t\t\tel.html(phpbb.colorPalette(orientation, width, height));\n\n\t\t\t// Attach event handler when a palette cell is clicked.\n\t\t\t$(el).on('click', 'a', function(e) {\n\t\t\t\tvar color = $(this).attr('data-color');\n\n\t\t\t\tif (bbcode) {\n\t\t\t\t\twindow.bbfontstyle('[color=#' + color + ']', '[/color]');\n\t\t\t\t}\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\n\t\tvar tocItems = $('#preview-detail-panel .toc a, #preview-detail-panel .pagination a').click(function(e) {\n\t\t\tvar url = $(this).attr('href').match(/\\/(\\d+)$/);\n\t\t\tvar page = (url !== null) ? url[1] : 1;\n\t\t\t$('.pages').hide();\n\t\t\t$('#page-' + page).show();\n\t\t\ttocItems.removeClass('current');\n\t\t\tif (page > 1) {\n\t\t\t\ttocItems.filter('[href$=\"' + page + '\"]').addClass('current');\n\t\t\t} else {\n\t\t\t\ttocItems.filter('.first').addClass('current');\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t});\n\t});\n})(jQuery, window, document);\n"]}