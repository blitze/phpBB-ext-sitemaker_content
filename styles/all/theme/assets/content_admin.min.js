!function(e,t,i){"use strict";var n={},a={},l={},o={},r={},d="summary",c=["summary","detail"],s={},f={},u=t.CodeMirror||{},p=t.postData||{},h=t.trans||{},v=t.twig||{},b=function(t){var i=e("#"+t+"-options-container"),n=i.parent().find(".field-multi").is(":checked");return i.append('<div class="field-option">'+v({ref:"option"}).render({field_name:t})+"</div>").find(".field-defaults").attr("type",n?"checkbox":"radio"),!1},g=function(t,i,n,a){var l=r.children().length,o={field_type:t,type_label:i,field_name:n,field_label:a,settings:""};o.settings+=v({ref:"settings"}).render(o),null!==v({ref:t})&&(o.settings+=v({ref:t}).render(o)),r.append(v({ref:"row"}).render(o)).accordion("refresh").accordion("option","active",l),e("html,body").animate({scrollTop:e("#cfield-"+n).offset().top},"32000")},m=function(t){if(t){var i=e("#"+t+"-type"),n=o.children("option:selected"),a=n.val(),l=i.val();if(l!==a){var d=["radio","checkbox","select"],c=e("#"+t+"-header"),s=e("#"+t+"-options-container").html();e("#"+t+"-options").remove(),null!==v({ref:a})&&(e("#"+t+"-panel").append(v({ref:a}).render({field_name:t})),d&&e.inArray(a,d)>-1&&e("#"+t+"-options-container").html(s).find(".field-defaults").attr("type","checkbox"===a?"checkbox":"radio")),i.val(a),c.children(".field-type").text("[ "+n.text()+" ]"),r.accordion("option","active",r.children().index(c.parent())),e("html,body").animate({scrollTop:e("#cfield-"+t).offset().top},"32000")}}},y=function(e){return e.parent().slideUp("slow").remove(),!1},k=function(){var t=[],i=[];return e('#fields-container .fieldLabel[value != ""]').each(function(){var n=e(this).val(),a=e(this).next().val().toUpperCase(),l=e(this).parents(".ui-accordion-content").next().val();i.push('<a class="button" href="'+n+'" title="'+n+'" ftype="'+l+'">'+a+"</a>"),t.push("<p><b>"+n+":</b> {{ "+a+" }}</p>")}),e("#available-fields").html(i.join("&nbsp;")).children(".button").button({disabled:!1}),!1},x=function(t){return e(".ctab").parent().removeClass("activetab"),e("#"+t).parent().attr("class","activetab"),e(".ctabcontent").hide(),e("#c"+t).show(),!1},w=function(){var t=e("#content_name").val(),i=e("#fieldsubmit"),n=0;e(".field_label").each(function(){e(this).val().length||n++}),n>0||!t?(x(t?"cfields":"ctype"),i.attr("disabled","disabled").removeClass("button1")):i.removeAttr("disabled").addClass("button1")},D=function(t,i){e("#dialog-add-field .error").remove();var l=t?e("#cfield-"+t).length>0?h.taken:"":h.fieldName,o=i?"":h.fieldLabel;return l&&e('<div class="error">'+l+"</div>").insertAfter(n),o&&e('<div class="error">'+o+"</div>").insertAfter(a),l||o?!0:!1},C=function(t){return u.fromTextArea(e("#tpl-custom-"+t).get(0),{theme:"monokai",mode:"html",lineNumbers:!0,lineWrapping:!1,autoRefresh:!0,styleActiveLine:!0,fixedGutter:!0,indentUnit:4,indentWithTabs:!0,coverGutterNextToScrollbar:!1})};e(i).ready(function(){var t={},i={},u={},_={},A="";e(".tpl").each(function(){v({id:e(this).attr("id").substring("14"),data:e(this).html()})}),n=e("#dialog-fieldname"),a=e("#dialog-fieldlabel"),l=e("#dialog-fieldtype"),o=e("#dialog-newtype"),r=e("#fields-container"),i[h.add]=function(){var t=n.val(),i=l.val(),o=a.val(),d=l.children("option:selected").text();D(t,o)||(g(i,d,t,o),r.sortable("refresh"),e(this).dialog("close"),k())},u[h.remove]=function(){y(t),r.sortable("refresh"),e(this).dialog("close"),k()},_[h.edit]=function(){m(A),e(this).dialog("close")},i[h.cancel]=function(){e(this).dialog("close")},u[h.cancel]=function(){e(this).dialog("close")},_[h.cancel]=function(){e(this).dialog("close")},e("#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete").dialog({autoOpen:!1,width:350,modal:!0,show:"slide",hide:"slide"});var T=e("#dialog-add-field");e("#add-field").button().click(function(t){t.preventDefault(),n.val(""),a.val(""),e("#dialog-add-field .error").remove(),T.dialog("option","buttons",i),T.dialog("open")});var L=e("#dialog-edit-field");r.on("click","a.edit-field",function(){A=e("#"+e(this).parent().prev().attr("id")+' input[type="hidden"]').val(),e("#dialog-newtype").val(e(this).parent().next().val()),L.dialog("option","buttons",_),L.dialog("open")});var S=e("#dialog-confirm-delete");r.on("click","a.remove-field",function(i){i.preventDefault(),t=e(this).parent(),e(this).hasClass("db-field")?(S.dialog("option","buttons",u),S.dialog("open")):(y(t),k())}),r.on("click","a.remove-option",function(t){y(e(this)),t.preventDefault()}),r.on("click","a.add-option",function(t){b(e(this).attr("id").substring("11")),e(this).blur(),t.preventDefault()});var U=!1;r.accordion({header:"> div > h3",active:!1,collapsible:!0,heightStyle:"content"}).sortable({handle:"h3",cursor:"move",axis:"y",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),U=!0,k()}}),e("#fields-container").on("blur",".fieldLabel",function(){k()}).on("keyup",'.field-option input[type="text"]',function(){e(this).prev().val(e(this).val())}).on("click",".field-multi",function(){e(this).parent().parent().find(".field-defaults").attr("type",e(this).is(":checked")?"checkbox":"radio")}),e("body").on("click",".toggle",function(t){var i=e(this).attr("id");e("#s"+i).slideToggle(),e(this).blur(),t.preventDefault()}),e(".fieldLabel, #content_name").change(function(){w()}),e("#fieldsubmit").click(function(){w()}),e.each(c,function(t,i){f[i]=e("#preview-"+i),s[i]=C(i),s[i].on("change",function(){f[i].html(v({data:s[i].getValue()}).render(p))})}),e("#post-info > a.button").button({disabled:!1}).click(function(t){t.preventDefault(),s[d].replaceSelection("{{ "+e(this).attr("tag")+" }}")}),e("#available-fields").on("click","a.button",function(t){t.preventDefault();var i="{{ "+e(this).text().toUpperCase()+" }}",n=e(this).attr("ftype");s[d].focus(),s[d].replaceSelection("image"===n?'<img class="cms-teaser-medium-image" src="'+i+'" />':i)}).children("a.button").button({disabled:!1}),e("#fields-template").on("click",".toggle-tpl",function(t){var i=e(this).attr("id");e(this).removeClass("ui-state-active").parent().children("li").not(this).addClass("ui-state-active"),e(".toggle-panel").hide(),e("#"+i+"-tpl").show(),d=i.substring("7"),t.preventDefault()}),e(".ctab").click(function(t){var i=e(this).attr("id");x(i),t.preventDefault()})})}(jQuery,window,document);