{"version":3,"sources":["acp/content_admin.min.js"],"names":["$","window","document","makeOptionsSortable","element","sortable","placeholder","forcePlaceholderSize","dropOnEmpty","disableSelection","addField","fieldType","fieldName","fieldLabel","items","containerObj","children","length","data","field_data","field","field_name","field_type","field_label","getJSON","ajaxUrl","row","$field","append","accordion","animate","scrollTop","offset","top","find","$element","console","log","each","$this","this","change","phpbb","toggleSelectSettings","makeOptionsTogglable","setAvailableFields","removeElement","el","parent","slideUp","remove","checkRequired","name","val","buttonObj","missingLabels","trigger","attr","removeClass","removeAttr","addClass","fNameObj","fLabelObj","typeObj","nTypeObj","view","views","textarea","preview","CodeMirror","postData","trans","Twig","buttons","label","next","toUpperCase","ftype","push","html","join","button","disabled","ready","removeObj","aButtons","cButtons","eButtons","fid","twig","id","substring","error1","taken","error2","insertAfter","checkField","dialog","cancel","deleteField","editField","tObj","nType","index","serializeArray","newRow","replaceWith","autoOpen","width","modal","show","hide","dialogAdd","click","e","preventDefault","dialogEdit","on","dialogConfirm","hasClass","ocontainer","itemsCount","ref","render","type","addFieldOption","blur","is","toggleFieldOptionDefaultsType","prev","previousValue","prop","header","active","collapsible","heightStyle","handle","cursor","axis","opacity","stop","event","ui","item","triggerHandler","$loadingIndicator","$topicBlocksInput","topicBlocksSortableOptions","connectWith","update","icons","i","slideToggle","fromTextArea","get","theme","mode","lineNumbers","lineWrapping","autoRefresh","styleActiveLine","fixedGutter","indentUnit","indentWithTabs","coverGutterNextToScrollbar","getEditor","getValue","replaceSelection","focus","tab","panelId","split","substr","indexOf","siblings","showTab","ajaxStart","loadingIndicator","ajaxStop","clearLoadingTimeout","fadeOut","alertTime","jQuery"],"mappings":"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","file":"content_admin.min.js","sourcesContent":["(function($, window, document) {\n\t'use strict';\n\n\tvar fNameObj = {};\n\tvar fLabelObj = {};\n\tvar typeObj = {};\n\tvar nTypeObj = {};\n\tvar containerObj = {};\n\tvar view = 'summary';\n\tvar views = ['summary', 'detail'];\n\tvar textarea = {};\n\tvar preview = {};\n\n\tvar CodeMirror = window.CodeMirror || {};\n\tvar postData = window.postData || {};\n\tvar trans = window.trans || {};\n\tvar Twig = window.Twig || {};\n\n\tvar makeOptionsSortable = function(element) {\n\t\telement.sortable({\n\t\t\tplaceholder: \"ui-state-highlight\",\n\t\t\tforcePlaceholderSize: true,\n\t\t\tdropOnEmpty: true\n\t\t}).disableSelection();\n\t};\n\n\tvar addFieldOption = function($element) {\n\t\tvar fieldName = $element.attr('id').substring(11);\n\t\tvar ocontainer = $('#' + fieldName + '-options-container');\n\t\tvar itemsCount = ocontainer.children().length;\n\n\t\tocontainer.append(Twig.twig({ ref: 'option' }).render({\n\t\t\tfield_name: fieldName,\n\t\t\ttype: $element.data('type'),\n\t\t\tindex: itemsCount + 1\n\t\t}));\n\t};\n\n\tvar toggleFieldOptionDefaultsType = function($element) {\n\t\tvar type = $element.is(':checked') ? 'checkbox' : 'radio';\n\t\tvar fieldName = $element.attr('id').substring(13);\n\n\t\t$('#add-option-' + fieldName).data('type', type);\n\t\t$('#' + fieldName + '-options-container')\n\t\t\t.find('.field-defaults')\n\t\t\t\t.attr('type', type);\n\t};\n\t\n\tvar makeOptionsTogglable = function($element) {\n\t\tconsole.log($element);\n\t\t$element\n\t\t\t.find('select[data-togglable-settings]')\n\t\t\t.each(function() {\n\t\t\t\tvar $this = $(this);\n\n\t\t\t\t$this.change(function() {\n\t\t\t\t\twindow.phpbb.toggleSelectSettings($this);\n\t\t\t\t});\n\t\t\t\twindow.phpbb.toggleSelectSettings($this);\n\t\t\t});\n\t};\n\n\tvar addField = function(fieldType, fieldName, fieldLabel) {\n\t\tvar items = containerObj.children().length;\n\t\tvar data = {\n\t\t\t'field_data': {\n\t\t\t\t'field': {\n\t\t\t\t\t'field_name': fieldName,\n\t\t\t\t\t'field_type': fieldType,\n\t\t\t\t\t'field_label': fieldLabel\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t$.getJSON(window.ajaxUrl + '&type=' + fieldType, data, function(row) {\n\t\t\tvar $field = $(row);\n\t\t\tcontainerObj.append($field).accordion('refresh').accordion('option', 'active', items);\n\t\t\t$('html,body').animate({ scrollTop: $field.offset().top }, 500, 'swing');\n\t\t\tmakeOptionsSortable(containerObj.find('#' + fieldName + '-options-container'));\n\t\t\tmakeOptionsTogglable($field);\n\t\t\tsetAvailableFields();\n\t\t});\n\t};\n\n\tvar editField = function(field) {\n\t\tvar tObj = $('#' + field + '-field_type');\n\t\tvar el = nTypeObj.children('option:selected');\n\n\t\tvar nType = el.val();\n\t\tvar oType = tObj.val();\n\n\t\tif (oType !== nType) {\n\t\t\tvar row = $('#cfield-' + field);\n\t\t\tvar index = row.index();\n\t\t\tvar data = row.find(':input').serializeArray();\n\n\t\t\t$.getJSON(window.ajaxUrl + '&type=' + nType, data, function(newRow) {\n\t\t\t\trow.replaceWith(newRow);\n\t\t\t\tcontainerObj.accordion('refresh').accordion('option', 'active', index);\n\t\t\t\t$('html,body').animate({ scrollTop: $('#cfield-' + field).offset().top }, 500, 'swing');\n\t\t\t\tsetAvailableFields();\n\t\t\t});\n\t\t}\n\t};\n\n\tvar removeElement = function(el) {\n\t\tel.parent().slideUp('slow').remove();\n\t\treturn false;\n\t};\n\n\tvar setAvailableFields = function() {\n\t\tvar buttons = [];\n\n\t\t$('#fields-container .field_label[value != \"\"]').each(function() {\n\t\t\tvar label = $(this).val();\n\t\t\tvar field = $(this).next().val().toUpperCase();\n\t\t\tvar ftype = $(this).next().next().val();\n\n\t\t\tbuttons.push('<a class=\"button\" href=\"#\" data-tag=\"' + field + '\" data-ftype=\"' + ftype + '\">' + label + '</a>');\n\t\t});\n\n\t\t$('#available-fields').html(buttons.join()).children('.button').button({ disabled: false });\n\t};\n\n\tvar showTab = function(tab) {\n\t\tvar panelId = $(tab).attr('href');\n\n\t\t// we set the view for the summary|detail templates \n\t\tview = panelId.split('-')[0].substr(1);\n\t\tview = (views.indexOf(view) < 0) ? 'summary' : view;\n\n\t\t$(tab).parent().addClass('activetab').siblings('li').removeClass('activetab');\n\t\t$(panelId).show().siblings().hide();\n\t};\n\n\tvar checkRequired = function() {\n\t\tvar name = $('#content-name').val();\n\t\tvar buttonObj = $('#fieldsubmit');\n\t\tvar missingLabels = 0;\n\n\t\t$('.field_label').each(function() {\n\t\t\tif (!$(this).val().length) {\n\t\t\t\tmissingLabels++;\n\t\t\t}\n\t\t});\n\n\t\tif (missingLabels > 0 || !name) {\n\t\t\tvar tab = (!name) ? 'ctype' : 'cfields';\n\t\t\t$('#content-tabs a[href^=\"#' + tab + '\"]').trigger('click');\n\t\t\tbuttonObj.attr('disabled', 'disabled').removeClass('button1');\n\t\t} else {\n\t\t\tbuttonObj.removeAttr('disabled').addClass('button1');\n\t\t}\n\t};\n\n\tvar checkField = function(fieldName, fieldLabel) {\n\t\t$('#dialog-add-field .error').remove();\n\t\tvar error1 = (!fieldName) ? trans.fieldName : (($('#cfield-' + fieldName).length > 0) ? trans.taken : '');\n\t\tvar error2 = (!fieldLabel) ? trans.fieldLabel : '';\n\n\t\tif (error1) {\n\t\t\t$('<div class=\"error\">' + error1 + '</div>').insertAfter(fNameObj);\n\t\t}\n\n\t\tif (error2) {\n\t\t\t$('<div class=\"error\">' + error2 + '</div>').insertAfter(fLabelObj);\n\t\t}\n\n\t\treturn !!(error1 || error2);\n\t};\n\n\tvar getEditor = function(view) {\n\t\treturn CodeMirror.fromTextArea($('#tpl-custom-' + view).get(0), {\n\t\t\ttheme: 'monokai',\n\t\t\tmode: 'html',\n\t\t\tlineNumbers: true,\n\t\t\tlineWrapping: false,\n\t\t\tautoRefresh: true,\n\t\t\tstyleActiveLine: true,\n\t\t\tfixedGutter: true,\n\t\t\tindentUnit: 4,\n\t\t\tindentWithTabs: true,\n\t\t\tcoverGutterNextToScrollbar: false\n\t\t});\n\t};\n\n\t$(document).ready(function() {\n\t\tvar removeObj = {};\n\t\tvar aButtons = {};\n\t\tvar cButtons = {};\n\t\tvar eButtons = {};\n\t\tvar fid = '';\n\n\t\t// collect all templates\n\t\t$('.tpl').each(function() {\n\t\t\tTwig.twig({\n\t\t\t\tid: $(this).attr('id').substring('14'),\n\t\t\t\tdata: $(this).html()\n\t\t\t});\n\t\t});\n\n\t\tfNameObj = $('#dialog-fieldname');\n\t\tfLabelObj = $('#dialog-fieldlabel');\n\t\ttypeObj = $('#dialog-fieldtype');\n\t\tnTypeObj = $('#dialog-newtype');\n\t\tcontainerObj = $('#fields-container');\n\n\t\taButtons[trans.addField] = function() {\n\t\t\tvar fieldName = fNameObj.val();\n\t\t\tvar fieldType = typeObj.val();\n\t\t\tvar fieldLabel = fLabelObj.val();\n\n\t\t\tif (!checkField(fieldName, fieldLabel)) {\n\t\t\t\taddField(fieldType, fieldName, fieldLabel);\n\t\t\t\tcontainerObj.sortable('refresh');\n\t\t\t\t$(this).dialog('close');\n\t\t\t}\n\t\t};\n\n\t\taButtons[trans.cancel] = function() {\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\tcButtons[trans.deleteField] = function() {\n\t\t\tremoveElement(removeObj);\n\t\t\tcontainerObj.sortable('refresh');\n\t\t\t$(this).dialog('close');\n\t\t\tsetAvailableFields();\n\t\t};\n\n\t\tcButtons[trans.cancel] = function() {\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\teButtons[trans.editField] = function() {\n\t\t\teditField(fid);\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\teButtons[trans.cancel] = function() {\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\t$('#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete').dialog({\n\t\t\tautoOpen: false,\n\t\t\twidth: 350,\n\t\t\tmodal: true,\n\t\t\tshow: 'slide',\n\t\t\thide: 'slide'\n\t\t});\n\n\t\tvar dialogAdd = $('#dialog-add-field');\n\t\t$('#add-field').button().click(function(e) {\n\t\t\te.preventDefault();\n\t\t\tfNameObj.val('');\n\t\t\tfLabelObj.val('');\n\t\t\t$('#dialog-add-field .error').remove();\n\n\t\t\tdialogAdd.dialog('option', 'buttons', aButtons);\n\t\t\tdialogAdd.dialog('open');\n\t\t});\n\n\t\tvar dialogEdit = $('#dialog-edit-field');\n\t\tcontainerObj.on('click', 'a.edit-field', function() {\n\t\t\tfid = $(this).data('field');\n\t\t\t$('#dialog-newtype').val($('#' + fid + '-field_type').val());\n\t\t\tdialogEdit.dialog('option', 'buttons', eButtons);\n\t\t\tdialogEdit.dialog('open');\n\t\t});\n\n\t\tvar dialogConfirm = $('#dialog-confirm-delete');\n\t\tcontainerObj.on('click', 'a.remove-field', function(e) {\n\t\t\te.preventDefault();\n\t\t\tremoveObj = $(this).parent();\n\t\t\tif ($(this).hasClass('db-field')) {\n\t\t\t\tdialogConfirm.dialog('option', 'buttons', cButtons);\n\t\t\t\tdialogConfirm.dialog('open');\n\t\t\t} else {\n\t\t\t\tremoveElement(removeObj);\n\t\t\t\tsetAvailableFields();\n\t\t\t}\n\t\t});\n\n\t\tcontainerObj.on('click', 'a.remove-option', function(e) {\n\t\t\tremoveElement($(this));\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tcontainerObj.on('click', 'a.add-option', function(e) {\n\t\t\taddFieldOption($(this));\n\t\t\t$(this).blur();\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tcontainerObj.on('click', 'input.toggle-multi', function() {\n\t\t\ttoggleFieldOptionDefaultsType($(this));\n\t\t});\n\n\t\tcontainerObj.on('blur', '.field_label', function() {\n\t\t\tsetAvailableFields();\n\t\t});\n\n\t\tcontainerObj.on('keyup', '.field-option input[type=\"text\"]', function() {\n\t\t\t$(this).prev().val($(this).val());\n\t\t});\n\n\t\tcontainerObj.on('click', 'input.field-defaults[type=radio]', function() {\n\t\t\t// Credit: http://smoothprogramming.com/jquery/toggle-radio-button-using-jquery/\n\t\t\tvar previousValue = $(this).data('storedValue');\n\t\t\tif (previousValue) {\n\t\t\t\t$(this).prop('checked', !previousValue);\n\t\t\t\t$(this).data('storedValue', !previousValue);\n\t\t\t} else {\n\t\t\t\t$(this).data('storedValue', true);\n\t\t\t\t$(\"input.field-defaults[type=radio]:not(:checked)\").data(\"storedValue\", false);\n\t\t\t}\n\t\t});\n\n\t\tcontainerObj.accordion({\n\t\t\t\theader: '> div > h3',\n\t\t\t\tactive: false,\n\t\t\t\tcollapsible: true,\n\t\t\t\theightStyle: 'content'\n\t\t\t})\n\t\t\t.sortable({\n\t\t\t\thandle: 'h3',\n\t\t\t\tcursor: 'move',\n\t\t\t\taxis: 'y',\n\t\t\t\topacity: 0.6,\n\t\t\t\tforcePlaceholderSize: true,\n\t\t\t\tplaceholder: 'ui-state-highlight',\n\t\t\t\tstop: function(event, ui) {\n\t\t\t\t\t// IE doesn't register the blur when sorting\n\t\t\t\t\t// so trigger focusout handlers to remove .ui-state-focus\n\t\t\t\t\tui.item.children('h3').triggerHandler('focusout');\n\t\t\t\t\tsetAvailableFields();\n\t\t\t\t}\n\t\t\t});\n\n\t\tmakeOptionsSortable(containerObj.find('.field-options-list'));\n\n\t\tvar $topicBlocksInput = $('#input-topic-blocks');\n\t\tvar topicBlocksSortableOptions = {\n\t\t\tconnectWith: '.topic-blocks',\n\t\t\tplaceholder: \"ui-state-highlight\",\n\t\t\tforcePlaceholderSize: true,\n\t\t\tdropOnEmpty: true,\n\t\t\tstop: function(event, ui) {\n\t\t\t\t// IE doesn't register the blur when sorting\n\t\t\t\t// so trigger focusout handlers to remove .ui-state-focus\n\t\t\t\tui.item.children('h3').triggerHandler('focusout');\n\t\t\t\t\n\t\t\t\t// Refresh accordion to handle new order\n\t\t\t\t$(this).accordion('refresh');\n\t\t\t},\n\t\t\tupdate: function() {\n\t\t\t\tvar items = [];\n\t\t\t\t$(this).find('li').each(function() {\n\t\t\t\t\titems.push($(this).data('service'));\n\t\t\t\t});\n\t\t\t\t$topicBlocksInput.val(items.join(','));\n\t\t\t}\n\t\t};\n\t\t\n\t\t$('.topic-blocks')\n\t\t\t.accordion({\n\t\t\t\theader: \"> li > h3\",\n\t\t\t\tactive: false,\n\t\t\t\tcollapsible: true,\n\t\t\t\theightStyle: 'content',\n\t\t\t\ticons: false\n\t\t\t})\n\t\t\t.children('li')\n\t\t\t.each(function(i, element) {\n\t\t\t\tif ($(element).find('.settings').length) {\n\t\t\t\t\t$(element).find('h3').append('<i class=\"fa fa-cog pull-right\"></i>');\n\t\t\t\t}\n\t\t\t});\n\n\t\t$('#selected-topic-blocks').sortable(topicBlocksSortableOptions);\n\n\t\tdelete topicBlocksSortableOptions.update;\n\n\t\t$('#available-topic-block-options').sortable(topicBlocksSortableOptions);\n\n\t\t$('body').on('click', '.toggle', function(e) {\n\t\t\tvar id = $(this).attr('id');\n\t\t\t$('#s' + id).slideToggle();\n\t\t\t$(this).blur();\n\t\t\te.preventDefault();\n\t\t});\n\n\t\t$('.fieldLabel, #content-name').change(function() {\n\t\t\tcheckRequired();\n\t\t});\n\n\t\t$('#fieldsubmit').click(function() {\n\t\t\tcheckRequired();\n\t\t});\n\n\t\t// editor\n\t\t$.each(views, function(i, view) {\n\t\t\tpreview[view] = $('#preview-' + view);\n\t\t\ttextarea[view] = getEditor(view);\n\n\t\t\ttextarea[view].on('change', function() {\n\t\t\t\tpreview[view].html(Twig.twig({ data: textarea[view].getValue() }).render(postData));\n\t\t\t});\n\t\t});\n\n\t\t$('#post-info > a.button').button({ disabled: false }).click(function(e) {\n\t\t\te.preventDefault();\n\t\t\ttextarea[view].replaceSelection('{{ ' + $(this).data('tag') + ' }}');\n\t\t});\n\n\t\t$('#available-fields').on('click', 'a.button', function(e) {\n\t\t\te.preventDefault();\n\t\t\tvar field = '{{ ' + $(this).data('tag').toUpperCase() + ' }}';\n\n\t\t\ttextarea[view].focus();\n\t\t\ttextarea[view].replaceSelection(field);\n\t\t}).children('a.button').button({ disabled: false });\n\n\t\t// Tabs for content type\n\t\t$('.ctab').click(function(e) {\n\t\t\te.preventDefault();\n\t\t\tshowTab(this);\n\t\t});\n\n\t\tvar $loadingIndicator;\n\t\t$(document).ajaxStart(function() {\n\t\t\t$loadingIndicator = window.phpbb.loadingIndicator();\n\t\t}).ajaxStop(function() {\n\t\t\twindow.phpbb.clearLoadingTimeout();\n\t\t\tif ($loadingIndicator) {\n\t\t\t\t$loadingIndicator.fadeOut(window.phpbb.alertTime);\n\t\t\t}\n\t\t});\n\t});\n})(jQuery, window, document);\n"]}