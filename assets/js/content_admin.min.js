!function(e,t,i,a){"use strict";var n={},l={},o={},d={},s={},r={},c={},f=function(t){var i=s.option,a=e("#"+t+"-options-container"),n=a.prev().is(":checked");return i=i.replace(/\[fieldName\]/gi,t),a.append('<div class="field-option">'+i+"</div>").find(".field-defaults").attr("type",n?"checkbox":"radio"),!1},u=function(t,i,n,l){var o=s.settings,d=r.children().length;s[t]!==a&&(o+=s[t]),o=o.replace(/\[fieldName\]/gi,n),o=o.replace(/\[fieldLabel\]/gi,l);var c="";c+='<div id="cfield-'+n+'" class="field">',c+='	<h3 id="'+n+'-header">'+l,c+='		<span class="small field-type">[ '+i+" ]</span>",c+="	</h3>",c+='	<div id="'+n+'-panel">'+o+"</div>",c+='	<div class="field-actions">',c+='		<a href="#" class="remove-field field-icon ui-dialog-titlebar-close ui-corner-all" title="'+trans.delete+'"><span class="ui-icon ui-icon-closethick">'+trans.delete+"</span></a>",c+='		<a href="#" class="edit-field field-icon ui-dialog-titlebar-close ui-corner-all" title="'+trans.edit+'"><span class="ui-icon ui-icon-gear">'+trans.edit+"</span></a>",c+="	</div>",c+='	<input type="hidden" id="'+n+'-type" name="fdata['+n+'][type]" value="'+t+'" />',c+="</div>",r.append(c).accordion("refresh").accordion("option","active",d),e("html,body").animate({scrollTop:e("#cfield-"+n).offset().top},"32000")},p=function(t){if(t){var i=e("#"+t+"-type"),n=d.children("option:selected"),l=n.val(),o=i.val();if(o!==l){var c=["radio","checkbox","select"],f=e("#"+t+"-header"),u=e("#"+t+"-options-container").html();e("#"+t+"-options").remove(),s[l]!==a&&(e("#"+t+"-panel").append(s[l].replace(/\[fieldName\]/gi,t)),c&&e.inArray(l,c)>-1&&e("#"+t+"-options-container").html(u).find(".field-defaults").attr("type","checkbox"===l?"checkbox":"radio")),i.val(l),f.children(".field-type").text("[ "+n.text()+" ]"),r.accordion("option","active",r.children().index(f.parent())),e("html,body").animate({scrollTop:e("#cfield-"+t).offset().top},"32000")}}},h=function(e){return e.parent().slideUp("slow").remove(),!1},v=function(){var t=[],i=[];return e('#fields-container .fieldLabel[value != ""]').each(function(){var a=e(this).val(),n=e(this).next().val().toUpperCase(),l=e(this).parents(".ui-accordion-content").next().val();i.push('<a class="button" href="'+a+'" title="'+a+'" ftype="'+l+'">'+n+"</a>"),t.push("<p><b>"+a+":</b> {"+n+"}</p>")}),e("#available-fields").html(i.join("&nbsp;")).children(".button").button({disabled:!1}),!1},g=function(t){return e(".ctab").parent().removeClass("activetab"),e("#"+t).parent().attr("class","activetab"),e(".ctabcontent").hide(),e("#c"+t).show(),!1},b=function(){var t="",i=e("#content_name").val(),a=e("#fieldsubmit");e(".fieldLabel").each(function(){t+=e(this).val()}),t&&i?a.removeAttr("disabled").addClass("button1"):(g(i?"cfields":"ctype"),a.attr("disabled","disabled").removeClass("button1"))},m=function(t,i){e("#dialog-add-field .error").remove();var a=t?e("#cfield-"+t).length>0?trans.taken:"":trans.fieldName,o=i?"":trans.fieldLabel;return a&&e('<div class="error">'+a+"</div>").insertAfter(n),o&&e('<div class="error">'+o+"</div>").insertAfter(l),a||o?!0:!1},y=function(e){for(var t in postData){var i="{"+t+"}";e.indexOf(i)>-1&&(e=e.replace(i,postData[t]))}return e};e(i).ready(function(){var t={},a={},k={},x={},w="";e(".tpl").each(function(){var t=e(this).attr("id").substring("14");s[t]=e(this).html()}),n=e("#dialog-fieldname"),l=e("#dialog-fieldlabel"),o=e("#dialog-fieldtype"),d=e("#dialog-newtype"),r=e("#fields-container"),a[trans.add]=function(){var t=n.val(),i=o.val(),a=l.val(),d=o.children("option:selected").text();m(t,a)||(u(i,d,t,a),r.sortable("refresh"),e(this).dialog("close"),v())},k[trans.delete]=function(){h(t),r.sortable("refresh"),e(this).dialog("close"),v()},x[trans.edit]=function(){p(w),e(this).dialog("close")},a[trans.cancel]=function(){e(this).dialog("close")},k[trans.cancel]=function(){e(this).dialog("close")},x[trans.cancel]=function(){e(this).dialog("close")},e("#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete").dialog({autoOpen:!1,width:350,modal:!0,show:"slide",hide:"slide"});var D=e("#dialog-add-field");e("#add-field").button().click(function(t){t.preventDefault(),n.val(""),l.val(""),e("#dialog-add-field .error").remove(),D.dialog("option","buttons",a),D.dialog("open")});var C=e("#dialog-edit-field");r.on("click","a.edit-field",function(){w=e("#"+e(this).parent().prev().attr("id")+' input[type="hidden"]').val(),e("#dialog-newtype").val(e(this).parent().next().val()),C.dialog("option","buttons",x),C.dialog("open")});var S=e("#dialog-confirm-delete");r.on("click","a.remove-field",function(i){i.preventDefault(),t=e(this).parent(),e(this).hasClass("db-field")?(S.dialog("option","buttons",k),S.dialog("open")):(h(t),v())}),r.on("click","a.remove-option",function(t){h(e(this)),t.preventDefault()}),r.on("click","a.add-option",function(t){f(e(this).attr("id").substring("11")),e(this).blur(),t.preventDefault()});var L=!1;r.accordion({header:"> div > h3",active:!1,collapsible:!0,heightStyle:"content"}).sortable({handle:"h3",cursor:"move",axis:"y",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),L=!0,v()}}),e("#fields-container").on("blur",".fieldLabel",function(){v()}).on("keyup",'.field-option input[type="text"]',function(){e(this).prev().val(e(this).val())}).on("click",".field-multi",function(){e(this).next().find(".field-defaults").attr("type",e(this).is(":checked")?"checkbox":"radio")}),e("body").on("click",".toggle",function(t){var i=e(this).attr("id");e("#s"+i).slideToggle(),e(this).blur(),t.preventDefault()}),e(".fieldLabel, #content_name").change(function(){b()}),e("#fieldsubmit").click(function(){b()});var A="summary",N=["summary","detail"],T={},U={};e.each(N,function(t,a){c[a]=ace.edit(a+"-editor"),T[a]=i.getElementById("tpl-custom-"+a),U[a]=e("#preview-"+a),T[a].style.display="none",c[a].setTheme("ace/theme/clouds_midnight"),c[a].getSession().setMode("ace/mode/html"),c[a].getSession().setValue(T[a].value),c[a].setShowPrintMargin(!1),c[a].getSession().on("change",function(){T[a].value=c[a].getSession().getValue(),U[a].html(y(T[a].value))})}),e("#post-info > a.button").button({disabled:!1}).click(function(t){t.preventDefault();var i=e(this).attr("tag");c[A].insert("{"+i+"}")}),e("#available-fields").on("click","a.button",function(t){t.preventDefault();var i="{"+e(this).text().toUpperCase()+"}",a=e(this).attr("ftype");c[A].focus(),"image"===a?c[A].insertHtml('<img class="cms-teaser-medium-image" src="'+i+'" />'):c[A].insert(i)}).children("a.button").button({disabled:!1}),e("#fields-template").on("click",".toggle-tpl",function(t){var i=e(this).attr("id");e(this).removeClass("ui-state-active").parent().children("li").not(this).addClass("ui-state-active"),e(".toggle-panel").hide(),e("#"+i+"-tpl").show(),A=i.substring("7"),c[A].resize(),t.preventDefault()}),e(".ctab").click(function(t){var i=e(this).attr("id");g(i),t.preventDefault()})})}(jQuery,window,document);