!function(f,u,p){"use strict";var h={},v={},b={},g={},m={},y="summary",k=["summary","detail"],x={},w={},S=u.CodeMirror||{},_=u.postData||{},D=u.trans||{},T=u.Twig||{},C=function(e){e.sortable({placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0}).disableSelection()},j=function(e){return e.parent().slideUp("slow").remove(),!1},O=function(){var a=[];f('#fields-container .field_label[value != ""]').each(function(){var e=f(this).val(),t=f(this).next().val().toUpperCase(),i=f(this).next().next().val();a.push('<a class="button" href="#" data-tag="'+t+'" data-ftype="'+i+'">'+e+"</a>")}),f("#available-fields").html(a.join()).children(".button").button({disabled:!1})},A=function(){var e=f("#content-name").val(),t=f("#fieldsubmit"),i=0;(f(".field_label").each(function(){f(this).val().length||i++}),0<i||!e)?(f('#content-tabs a[href^="#'+(e?"cfields":"ctype")+'"]').trigger("click"),t.attr("disabled","disabled").removeClass("button1")):t.removeAttr("disabled").addClass("button1")};f(p).ready(function(){var t={},i={},a={},e={},l="";f(".tpl").each(function(){T.twig({id:f(this).attr("id").substring("14"),data:f(this).html()})}),h=f("#dialog-fieldname"),v=f("#dialog-fieldlabel"),b=f("#dialog-fieldtype"),g=f("#dialog-newtype"),m=f("#fields-container"),i[D.addField]=function(){var e,t,i,a,l,o=h.val(),n=b.val(),d=v.val();(function(e,t){f("#dialog-add-field .error").remove();var i=e?0<f("#cfield-"+e).length?D.taken:"":D.fieldName,a=t?"":D.fieldLabel;return i&&f('<div class="error">'+i+"</div>").insertAfter(h),a&&f('<div class="error">'+a+"</div>").insertAfter(v),!(!i&&!a)})(o,d)||(e=n,t=o,i=d,a=m.children().length,l={field_data:{field:{field_name:t,field_type:e,field_label:i}}},f.getJSON(u.ajaxUrl+"&type="+e,l,function(e){m.append(e).accordion("refresh").accordion("option","active",a),f("html,body").animate({scrollTop:f("#cfield-"+t).offset().top},500,"swing"),C(m.find("#"+t+"-options-container")),O()}),m.sortable("refresh"),f(this).dialog("close"))},i[D.cancel]=function(){f(this).dialog("close")},a[D.deleteField]=function(){j(t),m.sortable("refresh"),f(this).dialog("close"),O()},a[D.cancel]=function(){f(this).dialog("close")},e[D.editField]=function(){!function(t){var e=f("#"+t+"-field_type"),i=g.children("option:selected").val();if(e.val()!==i){var a=f("#cfield-"+t),l=a.index(),o=a.find(":input").serializeArray();f.getJSON(u.ajaxUrl+"&type="+i,o,function(e){a.replaceWith(e),m.accordion("refresh").accordion("option","active",l),f("html,body").animate({scrollTop:f("#cfield-"+t).offset().top},500,"swing"),O()})}}(l),f(this).dialog("close")},e[D.cancel]=function(){f(this).dialog("close")},f("#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete").dialog({autoOpen:!1,width:350,modal:!0,show:"slide",hide:"slide"});var o=f("#dialog-add-field");f("#add-field").button().click(function(e){e.preventDefault(),h.val(""),v.val(""),f("#dialog-add-field .error").remove(),o.dialog("option","buttons",i),o.dialog("open")});var n=f("#dialog-edit-field");m.on("click","a.edit-field",function(){l=f(this).data("field"),f("#dialog-newtype").val(f("#"+l+"-field_type").val()),n.dialog("option","buttons",e),n.dialog("open")});var d=f("#dialog-confirm-delete");m.on("click","a.remove-field",function(e){e.preventDefault(),t=f(this).parent(),f(this).hasClass("db-field")?(d.dialog("option","buttons",a),d.dialog("open")):(j(t),O())}),m.on("click","a.remove-option",function(e){j(f(this)),e.preventDefault()}),m.on("click","a.add-option",function(e){var t,i,a,l;t=f(this),i=t.attr("id").substring(11),a=f("#"+i+"-options-container"),l=a.children().length,a.append(T.twig({ref:"option"}).render({field_name:i,type:t.data("type"),index:l+1})),f(this).blur(),e.preventDefault()}),m.on("click","input.toggle-multi",function(){var e,t,i;e=f(this),t=e.is(":checked")?"checkbox":"radio",i=e.attr("id").substring(13),f("#add-option-"+i).data("type",t),f("#"+i+"-options-container").find(".field-defaults").attr("type",t)}),m.on("blur",".field_label",function(){O()}),m.on("keyup",'.field-option input[type="text"]',function(){f(this).prev().val(f(this).val())}),m.on("click","input.field-defaults[type=radio]",function(){var e=f(this).data("storedValue");e?(f(this).prop("checked",!e),f(this).data("storedValue",!e)):(f(this).data("storedValue",!0),f("input.field-defaults[type=radio]:not(:checked)").data("storedValue",!1))}),m.accordion({header:"> div > h3",active:!1,collapsible:!0,heightStyle:"content"}).sortable({handle:"h3",cursor:"move",axis:"y",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),O()}}),C(m.find(".field-options-list"));var r,c=f("#input-topic-blocks"),s={connectWith:".topic-blocks",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0};f("#available-topic-block-options").sortable(s),s.update=function(){var e=[];f(this).find("li").each(function(){e.push(f(this).data("service"))}),c.val(e.join(","))},f("#selected-topic-blocks").sortable(s),f("body").on("click",".toggle",function(e){var t=f(this).attr("id");f("#s"+t).slideToggle(),f(this).blur(),e.preventDefault()}),f(".fieldLabel, #content-name").change(function(){A()}),f("#fieldsubmit").click(function(){A()}),f.each(k,function(e,t){var i;w[t]=f("#preview-"+t),x[t]=(i=t,S.fromTextArea(f("#tpl-custom-"+i).get(0),{theme:"monokai",mode:"html",lineNumbers:!0,lineWrapping:!1,autoRefresh:!0,styleActiveLine:!0,fixedGutter:!0,indentUnit:4,indentWithTabs:!0,coverGutterNextToScrollbar:!1})),x[t].on("change",function(){w[t].html(T.twig({data:x[t].getValue()}).render(_))})}),f("#post-info > a.button").button({disabled:!1}).click(function(e){e.preventDefault(),x[y].replaceSelection("{{ "+f(this).data("tag")+" }}")}),f("#available-fields").on("click","a.button",function(e){e.preventDefault();var t="{{ "+f(this).data("tag").toUpperCase()+" }}";x[y].focus(),x[y].replaceSelection(t)}).children("a.button").button({disabled:!1}),f(".ctab").click(function(e){var t,i;e.preventDefault(),i=f(t=this).attr("href"),y=i.split("-")[0].substr(1),y=k.indexOf(y)<0?"summary":y,f(t).parent().addClass("activetab").siblings("li").removeClass("activetab"),f(i).show().siblings().hide()}),f(p).ajaxStart(function(){r=u.phpbb.loadingIndicator()}).ajaxStop(function(){u.phpbb.clearLoadingTimeout(),r&&r.fadeOut(u.phpbb.alertTime)})})}(jQuery,window,document);
//# sourceMappingURL=content_admin.min.js.map
