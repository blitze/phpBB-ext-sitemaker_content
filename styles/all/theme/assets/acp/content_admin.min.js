!function(f,u,h){"use strict";function p(e){e.sortable({placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0}).disableSelection()}function g(e,i,t){var a=x.children().length,n={field_data:{field:{field_name:i,field_type:e,field_label:t}}};f.getJSON(u.ajaxUrl+"&type="+e,n,function(e){var t=f(e);x.append(t).accordion("refresh").accordion("option","active",a),f("html,body").animate({scrollTop:t.offset().top},500,"swing"),p(x.find("#"+i+"-options-container")),function(e){console.log(e),e.find("select[data-togglable-settings]").each(function(){var e=f(this);e.change(function(){u.phpbb.toggleSelectSettings(e)}),u.phpbb.toggleSelectSettings(e)})}(t),U()})}function b(e){return e.parent().slideUp("slow").remove(),!1}function v(){var e=f("#content-name").val(),t=f("#fieldsubmit"),i=0;f(".field_label").each(function(){f(this).val().length||i++}),0<i||!e?(f('#content-tabs a[href^="#'+(e?"cfields":"ctype")+'"]').trigger("click"),t.attr("disabled","disabled").removeClass("button1")):t.removeAttr("disabled").addClass("button1")}var m={},y={},k={},S={},x={},w="summary",_=["summary","detail"],D={},T={},C=u.CodeMirror||{},j=u.postData||{},O=u.trans||{},A=u.Twig||{},U=function(){var a=[];f('#fields-container .field_label[value != ""]').each(function(){var e=f(this).val(),t=f(this).next().val().toUpperCase(),i=f(this).next().next().val();a.push('<a class="button" href="#" data-tag="'+t+'" data-ftype="'+i+'">'+e+"</a>")}),f("#available-fields").html(a.join()).children(".button").button({disabled:!1})};f(h).ready(function(){var t={},i={},a={},e={},n="";f(".tpl").each(function(){A.twig({id:f(this).attr("id").substring("14"),data:f(this).html()})}),m=f("#dialog-fieldname"),y=f("#dialog-fieldlabel"),k=f("#dialog-fieldtype"),S=f("#dialog-newtype"),x=f("#fields-container"),i[O.addField]=function(){var e=m.val(),t=k.val(),i=y.val();!function(e,t){f("#dialog-add-field .error").remove();var i=e?0<f("#cfield-"+e).length?O.taken:"":O.fieldName,a=t?"":O.fieldLabel;return i&&f('<div class="error">'+i+"</div>").insertAfter(m),a&&f('<div class="error">'+a+"</div>").insertAfter(y),!(!i&&!a)}(e,i)&&(g(t,e,i),x.sortable("refresh"),f(this).dialog("close"))},i[O.cancel]=function(){f(this).dialog("close")},a[O.deleteField]=function(){b(t),x.sortable("refresh"),f(this).dialog("close"),U()},a[O.cancel]=function(){f(this).dialog("close")},e[O.editField]=function(){!function(t){var e=f("#"+t+"-field_type"),i=S.children("option:selected").val();if(e.val()!==i){var a=f("#cfield-"+t),n=a.index(),o=a.find(":input").serializeArray();f.getJSON(u.ajaxUrl+"&type="+i,o,function(e){a.replaceWith(e),x.accordion("refresh").accordion("option","active",n),f("html,body").animate({scrollTop:f("#cfield-"+t).offset().top},500,"swing"),U()})}}(n),f(this).dialog("close")},e[O.cancel]=function(){f(this).dialog("close")},f("#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete").dialog({autoOpen:!1,width:350,modal:!0,show:"slide",hide:"slide"});var o=f("#dialog-add-field");f("#add-field").button().click(function(e){e.preventDefault(),m.val(""),y.val(""),f("#dialog-add-field .error").remove(),o.dialog("option","buttons",i),o.dialog("open")});var l=f("#dialog-edit-field");x.on("click","a.edit-field",function(){n=f(this).data("field"),f("#dialog-newtype").val(f("#"+n+"-field_type").val()),l.dialog("option","buttons",e),l.dialog("open")});var d=f("#dialog-confirm-delete");x.on("click","a.remove-field",function(e){e.preventDefault(),t=f(this).parent(),f(this).hasClass("db-field")?(d.dialog("option","buttons",a),d.dialog("open")):(b(t),U())}),x.on("click","a.remove-option",function(e){b(f(this)),e.preventDefault()}),x.on("click","a.add-option",function(e){!function(e){var t=e.attr("id").substring(11),i=f("#"+t+"-options-container"),a=i.children().length;i.append(A.twig({ref:"option"}).render({field_name:t,type:e.data("type"),index:a+1}))}(f(this)),f(this).blur(),e.preventDefault()}),x.on("click","input.toggle-multi",function(){!function(e){var t=e.is(":checked")?"checkbox":"radio",i=e.attr("id").substring(13);f("#add-option-"+i).data("type",t),f("#"+i+"-options-container").find(".field-defaults").attr("type",t)}(f(this))}),x.on("blur",".field_label",function(){U()}),x.on("keyup",'.field-option input[type="text"]',function(){f(this).prev().val(f(this).val())}),x.on("click","input.field-defaults[type=radio]",function(){var e=f(this).data("storedValue");e?(f(this).prop("checked",!e),f(this).data("storedValue",!e)):(f(this).data("storedValue",!0),f("input.field-defaults[type=radio]:not(:checked)").data("storedValue",!1))}),x.accordion({header:"> div > h3",active:!1,collapsible:!0,heightStyle:"content"}).sortable({handle:"h3",cursor:"move",axis:"y",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),U()}}),p(x.find(".field-options-list"));var c,r=f("#input-topic-blocks"),s={connectWith:".topic-blocks",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0,stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),f(this).accordion("refresh")},update:function(){var e=[];f(this).find("li").each(function(){e.push(f(this).data("service"))}),r.val(e.join(","))}};f(".topic-blocks").accordion({header:"> li > h3",active:!1,collapsible:!0,heightStyle:"content",icons:!1}).children("li").each(function(e,t){f(t).find(".settings").length&&f(t).find("h3").append('<i class="fa fa-cog pull-right"></i>')}),f("#selected-topic-blocks").sortable(s),delete s.update,f("#available-topic-block-options").sortable(s),f("body").on("click",".toggle",function(e){var t=f(this).attr("id");f("#s"+t).slideToggle(),f(this).blur(),e.preventDefault()}),f(".fieldLabel, #content-name").change(function(){v()}),f("#fieldsubmit").click(function(){v()}),f.each(_,function(e,t){T[t]=f("#preview-"+t),D[t]=function(e){return C.fromTextArea(f("#tpl-custom-"+e).get(0),{theme:"monokai",mode:"html",lineNumbers:!0,lineWrapping:!1,autoRefresh:!0,styleActiveLine:!0,fixedGutter:!0,indentUnit:4,indentWithTabs:!0,coverGutterNextToScrollbar:!1})}(t),D[t].on("change",function(){T[t].html(A.twig({data:D[t].getValue()}).render(j))})}),f("#post-info > a.button").button({disabled:!1}).click(function(e){e.preventDefault(),D[w].replaceSelection("{{ "+f(this).data("tag")+" }}")}),f("#available-fields").on("click","a.button",function(e){e.preventDefault();var t="{{ "+f(this).data("tag").toUpperCase()+" }}";D[w].focus(),D[w].replaceSelection(t)}).children("a.button").button({disabled:!1}),f(".ctab").click(function(e){e.preventDefault(),function(e){var t=f(e).attr("href");w=t.split("-")[0].substr(1),w=_.indexOf(w)<0?"summary":w,f(e).parent().addClass("activetab").siblings("li").removeClass("activetab"),f(t).show().siblings().hide()}(this)}),f(h).ajaxStart(function(){c=u.phpbb.loadingIndicator()}).ajaxStop(function(){u.phpbb.clearLoadingTimeout(),c&&c.fadeOut(u.phpbb.alertTime)})})}(jQuery,window,document);
//# sourceMappingURL=content_admin.min.js.map
