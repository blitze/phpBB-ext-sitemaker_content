!function(e,t,i){"use strict";var n={},a={},l={},o={},d={},r={},s=t.ace||{},c=t.postData||{},f=t.trans||{},u=t.twig||{},h=function(t){var i=e("#"+t+"-options-container"),n=i.parent().find(".field-multi").is(":checked");return i.append('<div class="field-option">'+u({ref:"option"}).render({field_name:t})+"</div>").find(".field-defaults").attr("type",n?"checkbox":"radio"),!1},p=function(t,i,n,a){var l=d.children().length,o={field_type:t,type_label:i,field_name:n,field_label:a,settings:""};o.settings+=u({ref:"settings"}).render(o),null!==u({ref:t})&&(o.settings+=u({ref:t}).render(o)),d.append(u({ref:"row"}).render(o)).accordion("refresh").accordion("option","active",l),e("html,body").animate({scrollTop:e("#cfield-"+n).offset().top},"32000")},v=function(t){if(t){var i=e("#"+t+"-type"),n=o.children("option:selected"),a=n.val(),l=i.val();if(l!==a){var r=["radio","checkbox","select"],s=e("#"+t+"-header"),c=e("#"+t+"-options-container").html();e("#"+t+"-options").remove(),null!==u({ref:a})&&(e("#"+t+"-panel").append(u({ref:a}).render({field_name:t})),r&&e.inArray(a,r)>-1&&e("#"+t+"-options-container").html(c).find(".field-defaults").attr("type","checkbox"===a?"checkbox":"radio")),i.val(a),s.children(".field-type").text("[ "+n.text()+" ]"),d.accordion("option","active",d.children().index(s.parent())),e("html,body").animate({scrollTop:e("#cfield-"+t).offset().top},"32000")}}},g=function(e){return e.parent().slideUp("slow").remove(),!1},b=function(){var t=[],i=[];return e('#fields-container .fieldLabel[value != ""]').each(function(){var n=e(this).val(),a=e(this).next().val().toUpperCase(),l=e(this).parents(".ui-accordion-content").next().val();i.push('<a class="button" href="'+n+'" title="'+n+'" ftype="'+l+'">'+a+"</a>"),t.push("<p><b>"+n+":</b> {{ "+a+" }}</p>")}),e("#available-fields").html(i.join("&nbsp;")).children(".button").button({disabled:!1}),!1},m=function(t){return e(".ctab").parent().removeClass("activetab"),e("#"+t).parent().attr("class","activetab"),e(".ctabcontent").hide(),e("#c"+t).show(),!1},y=function(){var t=e("#content_name").val(),i=e("#fieldsubmit"),n=0;e(".field_label").each(function(){e(this).val().length||n++}),n>0||!t?(m(t?"cfields":"ctype"),i.attr("disabled","disabled").removeClass("button1")):i.removeAttr("disabled").addClass("button1")},k=function(t,i){e("#dialog-add-field .error").remove();var l=t?e("#cfield-"+t).length>0?f.taken:"":f.fieldName,o=i?"":f.fieldLabel;return l&&e('<div class="error">'+l+"</div>").insertAfter(n),o&&e('<div class="error">'+o+"</div>").insertAfter(a),l||o?!0:!1};e(i).ready(function(){var t={},x={},w={},D={},_="";e(".tpl").each(function(){u({id:e(this).attr("id").substring("14"),data:e(this).html()})}),n=e("#dialog-fieldname"),a=e("#dialog-fieldlabel"),l=e("#dialog-fieldtype"),o=e("#dialog-newtype"),d=e("#fields-container"),x[f.add]=function(){var t=n.val(),i=l.val(),o=a.val(),r=l.children("option:selected").text();k(t,o)||(p(i,r,t,o),d.sortable("refresh"),e(this).dialog("close"),b())},w[f.remove]=function(){g(t),d.sortable("refresh"),e(this).dialog("close"),b()},D[f.edit]=function(){v(_),e(this).dialog("close")},x[f.cancel]=function(){e(this).dialog("close")},w[f.cancel]=function(){e(this).dialog("close")},D[f.cancel]=function(){e(this).dialog("close")},e("#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete").dialog({autoOpen:!1,width:350,modal:!0,show:"slide",hide:"slide"});var C=e("#dialog-add-field");e("#add-field").button().click(function(t){t.preventDefault(),n.val(""),a.val(""),e("#dialog-add-field .error").remove(),C.dialog("option","buttons",x),C.dialog("open")});var S=e("#dialog-edit-field");d.on("click","a.edit-field",function(){_=e("#"+e(this).parent().prev().attr("id")+' input[type="hidden"]').val(),e("#dialog-newtype").val(e(this).parent().next().val()),S.dialog("option","buttons",D),S.dialog("open")});var A=e("#dialog-confirm-delete");d.on("click","a.remove-field",function(i){i.preventDefault(),t=e(this).parent(),e(this).hasClass("db-field")?(A.dialog("option","buttons",w),A.dialog("open")):(g(t),b())}),d.on("click","a.remove-option",function(t){g(e(this)),t.preventDefault()}),d.on("click","a.add-option",function(t){h(e(this).attr("id").substring("11")),e(this).blur(),t.preventDefault()});var L=!1;d.accordion({header:"> div > h3",active:!1,collapsible:!0,heightStyle:"content"}).sortable({handle:"h3",cursor:"move",axis:"y",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),L=!0,b()}}),e("#fields-container").on("blur",".fieldLabel",function(){b()}).on("keyup",'.field-option input[type="text"]',function(){e(this).prev().val(e(this).val())}).on("click",".field-multi",function(){e(this).parent().parent().find(".field-defaults").attr("type",e(this).is(":checked")?"checkbox":"radio")}),e("body").on("click",".toggle",function(t){var i=e(this).attr("id");e("#s"+i).slideToggle(),e(this).blur(),t.preventDefault()}),e(".fieldLabel, #content_name").change(function(){y()}),e("#fieldsubmit").click(function(){y()});var T="summary",U=["summary","detail"],j={},z={};e.each(U,function(t,n){r[n]=s.edit(n+"-editor"),j[n]=i.getElementById("tpl-custom-"+n),z[n]=e("#preview-"+n),j[n].style.display="none",r[n].setTheme("ace/theme/clouds_midnight"),r[n].getSession().setMode("ace/mode/html"),r[n].getSession().setValue(j[n].value),r[n].setShowPrintMargin(!1),r[n].getSession().on("change",function(){j[n].value=r[n].getSession().getValue(),z[n].html(u({data:j[n].value}).render(c))})}),e("#post-info > a.button").button({disabled:!1}).click(function(t){t.preventDefault(),r[T].insert("{{ "+e(this).attr("tag")+" }}")}),e("#available-fields").on("click","a.button",function(t){t.preventDefault();var i="{{ "+e(this).text().toUpperCase()+" }}",n=e(this).attr("ftype");r[T].focus(),r[T].insert("image"===n?'<img class="cms-teaser-medium-image" src="'+i+'" />':i)}).children("a.button").button({disabled:!1}),e("#fields-template").on("click",".toggle-tpl",function(t){var i=e(this).attr("id");e(this).removeClass("ui-state-active").parent().children("li").not(this).addClass("ui-state-active"),e(".toggle-panel").hide(),e("#"+i+"-tpl").show(),T=i.substring("7"),r[T].resize(),t.preventDefault()}),e(".ctab").click(function(t){var i=e(this).attr("id");m(i),t.preventDefault()})})}(jQuery,window,document);