!function(e,t,i){"use strict";var a={},o={},n={},l={},d={},r=["summary","detail"],c={},s={},f=t.CodeMirror||{},u=t.postData||{},p=t.trans||{},h=t.Twig||{},v=function(e){e.sortable({placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0}).disableSelection()},b=function(t){var i=t.attr("id").substring(11),a=e("#"+i+"-options-container"),o=a.children().length;a.append(h.twig({ref:"option"}).render({field_name:i,type:t.data("type"),index:o+1}))},g=function(t){var i=t.is(":checked")?"checkbox":"radio",a=t.attr("id").substring(13);e("#add-option-"+a).data("type",i),e("#"+a+"-options-container").find(".field-defaults").attr("type",i)},m=function(i,a,o){var n=d.children().length,l={field_data:{field:{field_name:a,field_type:i,field_label:o}}};e.getJSON(t.ajaxUrl+"&type="+i,l,function(t){d.append(t).accordion("refresh").accordion("option","active",n),e("html,body").animate({scrollTop:e("#cfield-"+a).offset().top},500,"swing"),v(d.find("#"+a+"-options-container")),w()})},y=function(i){var a=e("#"+i+"-field_type"),o=l.children("option:selected").val();if(a.val()!==o){var n=e("#cfield-"+i),r=n.index(),c=n.find(":input").serializeArray();e.getJSON(t.ajaxUrl+"&type="+o,c,function(t){n.replaceWith(t),d.accordion("refresh").accordion("option","active",r),e("html,body").animate({scrollTop:e("#cfield-"+i).offset().top},500,"swing"),w()})}},k=function(e){return e.parent().slideUp("slow").remove(),!1},w=function(){var t=[];e('#fields-container .field_label[value != ""]').each(function(){var i=e(this).val(),a=e(this).next().val().toUpperCase(),o=e(this).next().next().val();t.push('<a class="button" href="#" data-tag="'+a+'" data-ftype="'+o+'">'+i+"</a>")}),e("#available-fields").html(t.join()).children(".button").button({disabled:!1})},x=function(t){var i=e(t).attr("href");e(t).parent().addClass("activetab").siblings("li").removeClass("activetab"),e(i).show().siblings().hide()},S=function(){var t=e("#content-name").val(),i=e("#fieldsubmit"),a=0;e(".field_label").each(function(){e(this).val().length||a++}),a>0||!t?(e('#content-tabs a[href^="#'+(t?"cfields":"ctype")+'"]').trigger("click"),i.attr("disabled","disabled").removeClass("button1")):i.removeAttr("disabled").addClass("button1")},_=function(t,i){e("#dialog-add-field .error").remove();var n=t?e("#cfield-"+t).length>0?p.taken:"":p.fieldName,l=i?"":p.fieldLabel;return n&&e('<div class="error">'+n+"</div>").insertAfter(a),l&&e('<div class="error">'+l+"</div>").insertAfter(o),!(!n&&!l)},D=function(t){return f.fromTextArea(e("#tpl-custom-"+t).get(0),{theme:"monokai",mode:"html",lineNumbers:!0,lineWrapping:!1,autoRefresh:!0,styleActiveLine:!0,fixedGutter:!0,indentUnit:4,indentWithTabs:!0,coverGutterNextToScrollbar:!1})};e(i).ready(function(){var f={},T={},C={},j={},A="";e(".tpl").each(function(){h.twig({id:e(this).attr("id").substring("14"),data:e(this).html()})}),a=e("#dialog-fieldname"),o=e("#dialog-fieldlabel"),n=e("#dialog-fieldtype"),l=e("#dialog-newtype"),d=e("#fields-container"),T[p.addField]=function(){var t=a.val(),i=n.val(),l=o.val();_(t,l)||(m(i,t,l),d.sortable("refresh"),e(this).dialog("close"))},T[p.cancel]=function(){e(this).dialog("close")},C[p.deleteField]=function(){k(f),d.sortable("refresh"),e(this).dialog("close"),w()},C[p.cancel]=function(){e(this).dialog("close")},j[p.editField]=function(){y(A),e(this).dialog("close")},j[p.cancel]=function(){e(this).dialog("close")},e("#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete").dialog({autoOpen:!1,width:350,modal:!0,show:"slide",hide:"slide"});var O=e("#dialog-add-field");e("#add-field").button().click(function(t){t.preventDefault(),a.val(""),o.val(""),e("#dialog-add-field .error").remove(),O.dialog("option","buttons",T),O.dialog("open")});var U=e("#dialog-edit-field");d.on("click","a.edit-field",function(){A=e(this).data("field"),e("#dialog-newtype").val(e("#"+A+"-field_type").val()),U.dialog("option","buttons",j),U.dialog("open")});var N=e("#dialog-confirm-delete");d.on("click","a.remove-field",function(t){t.preventDefault(),f=e(this).parent(),e(this).hasClass("db-field")?(N.dialog("option","buttons",C),N.dialog("open")):(k(f),w())}),d.on("click","a.remove-option",function(t){k(e(this)),t.preventDefault()}),d.on("click","a.add-option",function(t){b(e(this)),e(this).blur(),t.preventDefault()}),d.on("click","input.toggle-multi",function(){g(e(this))}),d.on("blur",".field_label",function(){w()}),d.on("keyup",'.field-option input[type="text"]',function(){e(this).prev().val(e(this).val())}),d.on("click","input.field-defaults[type=radio]",function(){var t=e(this).data("storedValue");t?(e(this).prop("checked",!t),e(this).data("storedValue",!t)):(e(this).data("storedValue",!0),e("input.field-defaults[type=radio]:not(:checked)").data("storedValue",!1))});var V=!1;d.accordion({header:"> div > h3",active:!1,collapsible:!0,heightStyle:"content"}).sortable({handle:"h3",cursor:"move",axis:"y",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),V=!0,w()}}),v(d.find(".field-options-list"));var z=e("#input-topic-blocks"),L={connectWith:".topic-blocks",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0};e("#available-topic-block-options").sortable(L),L.update=function(){var t=[];e(this).find("li").each(function(){t.push(e(this).data("service"))}),z.val(t.join(","))},e("#selected-topic-blocks").sortable(L),e("body").on("click",".toggle",function(t){var i=e(this).attr("id");e("#s"+i).slideToggle(),e(this).blur(),t.preventDefault()}),e(".fieldLabel, #content-name").change(function(){S()}),e("#fieldsubmit").click(function(){S()}),e.each(r,function(t,i){s[i]=e("#preview-"+i),c[i]=D(i),c[i].on("change",function(){s[i].html(h.twig({data:c[i].getValue()}).render(u))})}),e("#post-info > a.button").button({disabled:!1}).click(function(t){t.preventDefault(),c.summary.replaceSelection("{{ "+e(this).data("tag")+" }}")}),e("#available-fields").on("click","a.button",function(t){t.preventDefault();var i="{{ "+e(this).data("tag").toUpperCase()+" }}";c.summary.focus(),c.summary.replaceSelection(i)}).children("a.button").button({disabled:!1}),e(".ctab").click(function(e){e.preventDefault(),x(this)});var W;e(i).ajaxStart(function(){W=t.phpbb.loadingIndicator()}).ajaxStop(function(){t.phpbb.clearLoadingTimeout(),W&&W.fadeOut(t.phpbb.alertTime)})})}(jQuery,window,document);
//# sourceMappingURL=content_admin.min.js.map
