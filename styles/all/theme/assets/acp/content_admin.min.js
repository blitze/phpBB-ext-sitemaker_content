!function(e,t,i){"use strict";var a={},o={},n={},l={},d={},r="summary",c=["summary","detail"],s={},f={},u=t.CodeMirror||{},p=t.postData||{},h=t.trans||{},v=t.Twig||{},b=function(e){e.sortable({placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0}).disableSelection()},g=function(t){var i=t.attr("id").substring(11),a=e("#"+i+"-options-container"),o=a.children().length;a.append(v.twig({ref:"option"}).render({field_name:i,type:t.data("type"),index:o+1}))},m=function(t){var i=t.is(":checked")?"checkbox":"radio",a=t.attr("id").substring(13);e("#add-option-"+a).data("type",i),e("#"+a+"-options-container").find(".field-defaults").attr("type",i)},y=function(i,a,o){var n=d.children().length,l={field_data:{field:{field_name:a,field_type:i,field_label:o}}};e.getJSON(t.ajaxUrl+"&type="+i,l,function(t){d.append(t).accordion("refresh").accordion("option","active",n),e("html,body").animate({scrollTop:e("#cfield-"+a).offset().top},500,"swing"),b(d.find("#"+a+"-options-container")),w()})},k=function(i){var a=e("#"+i+"-field_type"),o=l.children("option:selected").val();if(a.val()!==o){var n=e("#cfield-"+i),r=n.index(),c=n.find(":input").serializeArray();e.getJSON(t.ajaxUrl+"&type="+o,c,function(t){n.replaceWith(t),d.accordion("refresh").accordion("option","active",r),e("html,body").animate({scrollTop:e("#cfield-"+i).offset().top},500,"swing"),w()})}},x=function(e){return e.parent().slideUp("slow").remove(),!1},w=function(){var t=[];e('#fields-container .field_label[value != ""]').each(function(){var i=e(this).val(),a=e(this).next().val().toUpperCase(),o=e(this).next().next().val();t.push('<a class="button" href="#" data-tag="'+a+'" data-ftype="'+o+'">'+i+"</a>")}),e("#available-fields").html(t.join()).children(".button").button({disabled:!1})},S=function(t){var i=e(t).attr("href");r=i.split("-")[0].substr(1),r=c.indexOf(r)<0?"summary":r,e(t).parent().addClass("activetab").siblings("li").removeClass("activetab"),e(i).show().siblings().hide()},_=function(){var t=e("#content-name").val(),i=e("#fieldsubmit"),a=0;e(".field_label").each(function(){e(this).val().length||a++}),a>0||!t?(e('#content-tabs a[href^="#'+(t?"cfields":"ctype")+'"]').trigger("click"),i.attr("disabled","disabled").removeClass("button1")):i.removeAttr("disabled").addClass("button1")},D=function(t,i){e("#dialog-add-field .error").remove();var n=t?e("#cfield-"+t).length>0?h.taken:"":h.fieldName,l=i?"":h.fieldLabel;return n&&e('<div class="error">'+n+"</div>").insertAfter(a),l&&e('<div class="error">'+l+"</div>").insertAfter(o),!(!n&&!l)},T=function(t){return u.fromTextArea(e("#tpl-custom-"+t).get(0),{theme:"monokai",mode:"html",lineNumbers:!0,lineWrapping:!1,autoRefresh:!0,styleActiveLine:!0,fixedGutter:!0,indentUnit:4,indentWithTabs:!0,coverGutterNextToScrollbar:!1})};e(i).ready(function(){var u={},C={},j={},O={},A="";e(".tpl").each(function(){v.twig({id:e(this).attr("id").substring("14"),data:e(this).html()})}),a=e("#dialog-fieldname"),o=e("#dialog-fieldlabel"),n=e("#dialog-fieldtype"),l=e("#dialog-newtype"),d=e("#fields-container"),C[h.addField]=function(){var t=a.val(),i=n.val(),l=o.val();D(t,l)||(y(i,t,l),d.sortable("refresh"),e(this).dialog("close"))},C[h.cancel]=function(){e(this).dialog("close")},j[h.deleteField]=function(){x(u),d.sortable("refresh"),e(this).dialog("close"),w()},j[h.cancel]=function(){e(this).dialog("close")},O[h.editField]=function(){k(A),e(this).dialog("close")},O[h.cancel]=function(){e(this).dialog("close")},e("#dialog-add-field, #dialog-edit-field, #dialog-confirm-delete").dialog({autoOpen:!1,width:350,modal:!0,show:"slide",hide:"slide"});var U=e("#dialog-add-field");e("#add-field").button().click(function(t){t.preventDefault(),a.val(""),o.val(""),e("#dialog-add-field .error").remove(),U.dialog("option","buttons",C),U.dialog("open")});var N=e("#dialog-edit-field");d.on("click","a.edit-field",function(){A=e(this).data("field"),e("#dialog-newtype").val(e("#"+A+"-field_type").val()),N.dialog("option","buttons",O),N.dialog("open")});var V=e("#dialog-confirm-delete");d.on("click","a.remove-field",function(t){t.preventDefault(),u=e(this).parent(),e(this).hasClass("db-field")?(V.dialog("option","buttons",j),V.dialog("open")):(x(u),w())}),d.on("click","a.remove-option",function(t){x(e(this)),t.preventDefault()}),d.on("click","a.add-option",function(t){g(e(this)),e(this).blur(),t.preventDefault()}),d.on("click","input.toggle-multi",function(){m(e(this))}),d.on("blur",".field_label",function(){w()}),d.on("keyup",'.field-option input[type="text"]',function(){e(this).prev().val(e(this).val())}),d.on("click","input.field-defaults[type=radio]",function(){var t=e(this).data("storedValue");t?(e(this).prop("checked",!t),e(this).data("storedValue",!t)):(e(this).data("storedValue",!0),e("input.field-defaults[type=radio]:not(:checked)").data("storedValue",!1))});var z=!1;d.accordion({header:"> div > h3",active:!1,collapsible:!0,heightStyle:"content"}).sortable({handle:"h3",cursor:"move",axis:"y",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),z=!0,w()}}),b(d.find(".field-options-list"));var L=e("#input-topic-blocks"),W={connectWith:".topic-blocks",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,dropOnEmpty:!0};e("#available-topic-block-options").sortable(W),W.update=function(){var t=[];e(this).find("li").each(function(){t.push(e(this).data("service"))}),L.val(t.join(","))},e("#selected-topic-blocks").sortable(W),e("body").on("click",".toggle",function(t){var i=e(this).attr("id");e("#s"+i).slideToggle(),e(this).blur(),t.preventDefault()}),e(".fieldLabel, #content-name").change(function(){_()}),e("#fieldsubmit").click(function(){_()}),e.each(c,function(t,i){f[i]=e("#preview-"+i),s[i]=T(i),s[i].on("change",function(){f[i].html(v.twig({data:s[i].getValue()}).render(p))})}),e("#post-info > a.button").button({disabled:!1}).click(function(t){t.preventDefault(),s[r].replaceSelection("{{ "+e(this).data("tag")+" }}")}),e("#available-fields").on("click","a.button",function(t){t.preventDefault();var i="{{ "+e(this).data("tag").toUpperCase()+" }}";s[r].focus(),s[r].replaceSelection(i)}).children("a.button").button({disabled:!1}),e(".ctab").click(function(e){e.preventDefault(),S(this)});var F;e(i).ajaxStart(function(){F=t.phpbb.loadingIndicator()}).ajaxStop(function(){t.phpbb.clearLoadingTimeout(),F&&F.fadeOut(t.phpbb.alertTime)})})}(jQuery,window,document);
//# sourceMappingURL=content_admin.min.js.map
